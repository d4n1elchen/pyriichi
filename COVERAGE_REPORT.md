# PyRiichi 測試覆蓋率報告

生成時間：2025年11月10日

## 總體覆蓋率

**總體覆蓋率：87%** (2171 行代碼，272 行未覆蓋) ✅ **已超過 80% 目標！**

目標覆蓋率：> 80% ✅ **已達成**
目標覆蓋率：> 85% ✅ **已達成**
目標覆蓋率：> 90% ❌ **未達成**

## 各模組覆蓋率詳情

### ✅ 完美覆蓋（100%）
- `pyriichi/__init__.py`: 100% (10/10 行)
- `pyriichi/rules_config.py`: 100% (31/31 行)
- `pyriichi/utils.py`: 100% (30/30 行)

### 🟢 優秀覆蓋（≥90%）
- `pyriichi/game_state.py`: 95% (89/94 行)
- `pyriichi/hand.py`: 92% (355/387 行)
- `pyriichi/scoring.py`: 90% (131/146 行)

### 🟡 良好覆蓋（≥80%）
- `pyriichi/tiles.py`: 89% (142/159 行)
- `pyriichi/rules.py`: 85% (465/546 行)
- `pyriichi/yaku.py`: 84% (627/745 行)
- `pyriichi/enum_utils.py`: 83% (19/23 行)

## 主要未覆蓋區域

### 1. `pyriichi/rules.py` (85% 覆蓋率)

**未覆蓋的主要功能（剩餘 15%）：**
- **部分邊界情況**
  - 某些特定遊戲狀態下的分支
  - 極少發生的錯誤處理路徑

- **槓相關功能的部分邊界情況**
  - 某些特殊場景下的槓處理
  - 王牌區耗盡的極端情況

- **流局處理的部分邊界情況**
  - 某些特殊流局場景
  - 極少發生的邊界情況

### 2. `pyriichi/yaku.py` (84% 覆蓋率)

**未覆蓋的主要功能（剩餘 16%）：**
- **部分役種的邊界情況**
  - 某些特殊組合的判定邏輯
  - 役種衝突檢測的邊界情況
  - 部分役滿的特殊情況

**未覆蓋行數：** 118 行
- 主要集中在特殊役種和邊界情況的處理

### 3. `pyriichi/hand.py` (92% 覆蓋率)

**未覆蓋的主要功能（剩餘 8%）：**
- **部分邊界情況**
  - 某些特殊手牌組合的處理
  - 錯誤處理分支
  - 部分輔助方法

**未覆蓋行數：** 32 行
- 主要集中在錯誤處理和邊界情況（例如非法操作的例外）

### 4. `pyriichi/scoring.py` (90% 覆蓋率)

**未覆蓋的主要功能（剩餘 10%）：**
- **符數與等待型的部分極端分支**
- **未覆蓋行數：** 15 行

### 5. `pyriichi/tiles.py` (89% 覆蓋率)

- **未覆蓋的主要功能（剩餘 11%）：**
  - 少數防禦性檢查與例外處理
  - **未覆蓋行數：** 17 行

### 6. `pyriichi/enum_utils.py` (83% 覆蓋率)

- **未覆蓋的主要功能（剩餘 17%）：**
  - 少數語系轉換相關的錯誤分支
  - **未覆蓋行數：** 4 行

## 覆蓋率趨勢

### 當前狀態
- **總體覆蓋率：87%** ✅ **維持在 85% 以上**
- **完美覆蓋模組：3 個** (`__init__.py`, `rules_config.py`, `utils.py`)
- **優秀覆蓋模組（≥90%）：3 個** (`game_state.py` 95%, `hand.py` 92%, `scoring.py` 90%)
- **良好覆蓋模組（≥80%）：4 個** (`tiles.py` 89%, `rules.py` 85%, `yaku.py` 84%, `enum_utils.py` 83%)

### 覆蓋率提升
- **總體覆蓋率：** 86% → 87% (+1%)
- **`scoring.py` 覆蓋率：** 90% (維持)

### 改進建議

#### 優先級 1：提升 `rules.py` 覆蓋率（85% → 90%+）
1. **添加邊界情況測試**
   - 某些特定遊戲狀態下的動作執行
   - 極少發生的錯誤處理路徑
   - 王牌區耗盡的極端情況

2. **添加流局處理的邊界情況測試**
   - 某些特殊流局場景
   - 極少發生的邊界情況

#### 優先級 2：提升 `yaku.py` 覆蓋率（84% → 90%+）
1. **添加特殊役種的邊界情況測試**
   - 某些特殊組合的判定邏輯測試
   - 役種衝突檢測的邊界情況測試
   - 部分役滿的特殊情況測試

#### 優先級 3：維持 `hand.py` 覆蓋率（92%）並補齊邊界情境
1. **補充剩餘錯誤處理測試**
   - 測試非法動作（例如嘗試吃/碰/槓不存在的牌）
   - 確保所有例外拋出分支被觸發
2. **覆蓋極端手牌組合**
   - 例如 4 槓、四暗刻單騎等罕見情境

#### 優先級 4：提升 `tiles.py` 覆蓋率（89% → 95%+）
1. **補充防禦性檢查的測試**
2. **覆蓋紅寶牌與字牌邊界**

#### 優先級 5：提升 `enum_utils.py` 覆蓋率（83% → 90%）
1. **測試所有語系組合**
2. **覆蓋例外與錯誤分支**

## 測試統計

- **總測試數：** 232 個測試 ✅
- **通過率：** 100%
- **測試文件：**
  - `tests/test_rules.py`: 規則引擎測試
  - `tests/test_scoring.py`: 得分計算測試
  - `tests/test_yaku.py`: 役種判定測試
  - `tests/test_hand.py`: 手牌管理測試
  - `tests/test_tiles.py`: 牌和牌組測試
  - `tests/test_game_state.py`: 遊戲狀態測試
  - `tests/test_utils.py`: 工具函數測試
  - `tests/test_integration.py`: 整合測試

## 覆蓋率目標

### 短期目標（已完成 ✅）
- [x] 總體覆蓋率 > 80%
- [x] 核心模組（scoring.py, tiles.py）> 85%
- [x] 至少 3 個模組達到 100% 覆蓋率

### 中期目標（已完成 ✅）
- [x] 總體覆蓋率 > 85% ✅ **已達成 87%！**
- [x] `rules.py` 覆蓋率 > 75% ✅ **已達成 85%！**
- [x] `yaku.py` 覆蓋率 > 80% ✅ **已達成 84%！**
- [x] `hand.py` 覆蓋率 > 90% (目前 92%)

### 長期目標
- [ ] 總體覆蓋率 > 90% (目前 87%)
- [ ] 所有核心模組 > 90% (rules.py 85%, yaku.py 84%, scoring.py 90%)
- [ ] 所有模組 > 85% (enum_utils.py 83% 仍待提升)

## 備註

- 覆蓋率報告使用 `coverage` 工具生成
- HTML 報告位於 `htmlcov/index.html`（使用 `coverage html` 生成）
- 某些未覆蓋的代碼可能是：
  - 防禦性編程（錯誤處理）
  - 極少發生的邊界情況
  - 需要特定環境或配置的場景
  - 未來功能的預留代碼
