# PyRiichi 測試覆蓋率報告

生成時間：2024年（已更新）

## 總體覆蓋率

**總體覆蓋率：82%** (1855 行代碼，328 行未覆蓋) ✅ **已超過 80% 目標！**

目標覆蓋率：> 80% ✅ **已達成**

## 各模組覆蓋率詳情

### ✅ 完美覆蓋（100%）
- `pyriichi/__init__.py`: 100% (9/9 行)
- `pyriichi/game_state.py`: 100% (76/76 行)
- `pyriichi/utils.py`: 100% (25/25 行)

### 🟢 優秀覆蓋（≥95%）
- `pyriichi/scoring.py`: 98% (161/164 行) - 僅 3 行未覆蓋（351-352, 362）
- `pyriichi/tiles.py`: 99% (133/134 行) - 僅 1 行未覆蓋（287）

### 🟢 良好覆蓋（≥75%）
- `pyriichi/hand.py`: 87% (271/311 行) - 40 行未覆蓋
- `pyriichi/yaku.py`: 79% (597/759 行) - 162 行未覆蓋
- `pyriichi/rules.py`: 68% (255/377 行) - 122 行未覆蓋

## 主要未覆蓋區域

### 1. `pyriichi/rules.py` (68% 覆蓋率)

**未覆蓋的主要功能（剩餘 32%）：**
- **動作執行相關** (155-162, 191-195, 199, 209, 214-215, 218, 222 行)
  - 部分邊界情況和特殊場景
  - 某些特定遊戲狀態下的分支

- **槓相關功能** (230-300 行)
  - 明槓和暗槓的完整流程
  - 搶槓和嶺上開花的實際和牌場景（需要特定手牌配置）
  - 王牌區耗盡處理

- **流局處理** (327, 354, 369-370, 383, 402, 448, 475, 480, 503, 510-518, 573, 579, 602-607, 614-617, 637-658, 667-675, 684-692, 713, 736 行)
  - 部分流局檢查的邊界情況
  - 流局滿貫判定
  - 某些特殊流局場景

### 2. `pyriichi/yaku.py` (79% 覆蓋率)

**未覆蓋的主要功能（剩餘 21%）：**
- **部分役種的邊界情況**
  - 某些特殊組合的判定邏輯
  - 役種衝突檢測的邊界情況
  - 部分役滿的特殊情況

**未覆蓋行數：** 162 行
- 主要集中在特殊役種和邊界情況的處理

### 3. `pyriichi/hand.py` (87% 覆蓋率)

**未覆蓋的主要功能（剩餘 13%）：**
- **部分邊界情況**
  - 某些特殊手牌組合的處理
  - 錯誤處理分支
  - 部分輔助方法

**未覆蓋行數：** 40 行
- 主要集中在錯誤處理和邊界情況

### 4. `pyriichi/scoring.py` (98% 覆蓋率)

**未覆蓋的主要功能（剩餘 2%）：**
- **極少數邊界情況** (351-352, 362 行)
  - 僅 3 行未覆蓋，接近完美

### 5. `pyriichi/tiles.py` (99% 覆蓋率)

**未覆蓋的主要功能（剩餘 1%）：**
- **極少數邊界情況** (287 行)
  - 僅 1 行未覆蓋，接近完美

## 覆蓋率趨勢

### 當前狀態
- **總體覆蓋率：82%** ✅
- **完美覆蓋模組：3 個** (__init__.py, game_state.py, utils.py)
- **優秀覆蓋模組（≥95%）：2 個** (scoring.py, tiles.py)
- **良好覆蓋模組（≥75%）：3 個** (hand.py, yaku.py, rules.py)

### 改進建議

#### 優先級 1：提升 `rules.py` 覆蓋率（68% → 75%+）
1. **添加槓相關測試**
   - 明槓和暗槓的完整流程測試
   - 搶槓和嶺上開花的實際場景測試
   - 王牌區耗盡的邊界情況測試

2. **添加流局處理測試**
   - 各種流局類型的詳細測試
   - 流局滿貫判定的測試
   - 特殊流局場景的測試

3. **添加動作執行的邊界情況測試**
   - 各種遊戲狀態下的動作執行
   - 錯誤處理分支的測試

#### 優先級 2：提升 `yaku.py` 覆蓋率（79% → 85%+）
1. **添加特殊役種測試**
   - 特殊組合的判定邏輯測試
   - 役種衝突檢測的邊界情況測試
   - 部分役滿的特殊情況測試

#### 優先級 3：提升 `hand.py` 覆蓋率（87% → 90%+）
1. **添加邊界情況測試**
   - 特殊手牌組合的處理測試
   - 錯誤處理分支的測試
   - 輔助方法的測試

## 測試統計

- **總測試數：** 184 個測試
- **通過率：** 100%
- **測試文件：**
  - `tests/test_rules.py`: 規則引擎測試
  - `tests/test_scoring.py`: 得分計算測試
  - `tests/test_yaku.py`: 役種判定測試
  - `tests/test_hand.py`: 手牌管理測試
  - `tests/test_tiles.py`: 牌和牌組測試
  - `tests/test_game_state.py`: 遊戲狀態測試
  - `tests/test_utils.py`: 工具函數測試

## 覆蓋率目標

### 短期目標（已完成 ✅）
- [x] 總體覆蓋率 > 80%
- [x] 核心模組（scoring.py, tiles.py）> 95%
- [x] 至少 3 個模組達到 100% 覆蓋率

### 中期目標
- [ ] 總體覆蓋率 > 85%
- [ ] `rules.py` 覆蓋率 > 75%
- [ ] `yaku.py` 覆蓋率 > 85%
- [ ] `hand.py` 覆蓋率 > 90%

### 長期目標
- [ ] 總體覆蓋率 > 90%
- [ ] 所有核心模組 > 90%
- [ ] 所有模組 > 85%

## 備註

- 覆蓋率報告使用 `pytest-cov` 生成
- HTML 報告位於 `htmlcov/index.html`
- 某些未覆蓋的代碼可能是：
  - 防禦性編程（錯誤處理）
  - 極少發生的邊界情況
  - 需要特定環境或配置的場景
  - 未來功能的預留代碼

## 更新日誌

- **2024年（最新）**: 總體覆蓋率 82%，修復測試錯誤，清理測試註解
- **2024年（之前）**: 總體覆蓋率 85%，實現自風對子符數計算、平和榮和符數修正
